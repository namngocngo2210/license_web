{% extends "base.html" %}

{% block title %}Hồ sơ{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-5">
        <div class="md-card">
            <div class="md-card-header">
                <h5 class="mb-1 fw-semibold">Thông tin cá nhân</h5>
                <p class="card-subtitle mb-0">Cập nhật tên và email của bạn</p>
            </div>
            <div class="md-card-body">
                <form method="post" class="d-grid gap-3">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="profile">
                    {% for field in profile_form %}
                        <div>
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                            {{ field }}
                            {% for error in field.errors %}
                                <div class="text-danger small mt-1">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                    <button class="btn btn-primary">Lưu thay đổi</button>
                </form>
            </div>
        </div>
        <div class="md-card mt-4">
            <div class="md-card-header">
                <h5 class="mb-1 fw-semibold">API Key</h5>
                <p class="card-subtitle mb-0">Dùng để xác thực khi gọi API</p>
            </div>
            <div class="md-card-body">
                {% if api_key %}
                    <div class="input-group">
                        <input type="password" class="form-control" id="apiKeyInput" value="{{ api_key }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="toggleKeyBtn">Hiện</button>
                        <button class="btn btn-outline-primary" type="button" id="copyKeyBtn">Copy</button>
                    </div>
                    <small class="text-muted d-block mt-2">Giữ bí mật API Key của bạn.</small>
                {% else %}
                    <div class="alert alert-warning mb-0">Chưa có API Key.</div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-7">
        <div class="md-card">
            <div class="md-card-header">
                <h5 class="mb-1 fw-semibold">Đổi mật khẩu</h5>
                <p class="card-subtitle mb-0">Nhập mật khẩu hiện tại và mật khẩu mới</p>
            </div>
            <div class="md-card-body">
                <form method="post" class="d-grid gap-3">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="password">
                    {% for field in password_form %}
                        <div>
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                            {{ field }}
                            {% for error in field.errors %}
                                <div class="text-danger small mt-1">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                    <button class="btn btn-warning">Đổi mật khẩu</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('apiKeyInput');
    const toggleBtn = document.getElementById('toggleKeyBtn');
    const copyBtn = document.getElementById('copyKeyBtn');
    if (toggleBtn && input) {
        toggleBtn.addEventListener('click', () => {
            const isHidden = input.type === 'password';
            input.type = isHidden ? 'text' : 'password';
            toggleBtn.textContent = isHidden ? 'Ẩn' : 'Hiện';
        });
    }
    if (copyBtn && input) {
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(input.value);
                copyBtn.textContent = 'Đã copy';
                setTimeout(() => copyBtn.textContent = 'Copy', 1500);
            } catch (e) {
                alert('Không thể copy API Key.');
            }
        });
    }
});
</script>
{% endblock %}


